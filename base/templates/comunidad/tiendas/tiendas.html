{% extends 'partials/admin/body.html' %}
{% load crispy_forms_tags %}
{% load bootstrap_icons %}

{% block contenido %}
  <div class="container-fluid m-4">
    <div class="row">
      <!-- Formulario -->
      <div class="col-md-3">
        <div class="card rounded p-3">
          <h5 class="card-title mb-3">{{ accion }} {{ titulo }}</h5>
          <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            {{ form|crispy }}
            <div class="d-grid gap-2 mt-3">
              <button class="btn btn-success" type="submit">
                {{ accion }} {{ titulo }}
              </button>
              <a href="{% url 'tiendas' %}" class="btn btn-secondary">Cancelar</a>
            </div>
          </form>
        </div>
      </div>

      <!-- Tabla -->
      <div class="col-md-9">
        <div class="card rounded p-3">
          <h5 class="card-title mb-3">Lista de {{ titulo }}s</h5>
          <div class="table-responsive">
            <table class="table table-bordered table-hover w-100" id="tabla-tiendas">
              <thead class="table-light">
                <tr>
                  <th>Nombre</th>
                  <th>NIT</th>
                  <th>Responsable</th>
                  <th class="text-center" style="width: 150px;">Acciones</th>
                </tr>
              </thead>
              <tbody>
                {% for tienda in tiendas %}
                  {% if tienda.estado %}
                    <tr>
                      <td>{{ tienda.nombre }}</td>
                      <td>{{ tienda.nit }}</td>
                      <td>
                        {% if tienda.usuario %}
                          {{ tienda.usuario.full_name }}
                        {% else %}
                          <span class="text-muted">Sin responsable</span>
                        {% endif %}
                      </td>
                      <td class="text-center">
                        <!-- Botón Editar -->
                        <a href="{% url 'tienda-editar' tienda.id %}" 
                           class="btn btn-sm btn-primary" 
                           data-bs-toggle="tooltip" 
                           data-bs-placement="top" 
                           title="Editar">
                          {% bs_icon 'pencil' size='1em' %}
                        </a>

                        <!-- Botón Eliminar -->
                        <button type="button" 
                                class="btn btn-sm btn-danger" 
                                data-bs-toggle="modal" 
                                data-bs-target="#modalEliminar{{ tienda.id }}" 
                                title="Eliminar">
                          {% bs_icon 'trash' size='1em' %}
                        </button>

                        <!-- Modal de confirmación -->
                        <div class="modal fade" 
                             id="modalEliminar{{ tienda.id }}" 
                             data-bs-backdrop="static" 
                             data-bs-keyboard="false" 
                             tabindex="-1" 
                             aria-labelledby="modalLabel{{ tienda.id }}" 
                             aria-hidden="true">
                          <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                              <div class="modal-header bg-danger text-white">
                                <h5 class="modal-title" id="modalLabel{{ tienda.id }}">
                                  {% bs_icon 'exclamation-triangle' %} Confirmar eliminación
                                </h5>
                                <button type="button" 
                                        class="btn-close btn-close-white" 
                                        data-bs-dismiss="modal" 
                                        aria-label="Close">
                                </button>
                              </div>
                              <div class="modal-body">
                                <p class="mb-0">
                                  ¿Está seguro de eliminar la tienda <strong>{{ tienda.nombre }}</strong>?
                                </p>
                                <p class="text-muted small mb-0 mt-2">
                                  Esta acción no se puede deshacer.
                                </p>
                              </div>
                              <div class="modal-footer">
                                <button type="button" 
                                        class="btn btn-secondary" 
                                        data-bs-dismiss="modal">
                                  Cancelar
                                </button>
                                <a href="{% url 'tienda-eliminar' tienda.id %}" 
                                   class="btn btn-danger">
                                  Sí, eliminar
                                </a>
                              </div>
                            </div>
                          </div>
                        </div>
                      </td>
                    </tr>
                  {% endif %}
                {% empty %}
                  <tr>
                    <td colspan="4" class="text-center text-muted py-4">
                      No hay tiendas registradas
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Inicializar tooltips -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
      var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
      });
    });
  </script>
{% endblock %}