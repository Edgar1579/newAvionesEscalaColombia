{% load static %}
<script src="{% static 'js/jquery/jquery.min.js'%}"></script>
<script src="{% static 'js/adminlte/adminlte.js'%}"></script>

<!-- para las tablas -->
<script src="{% static 'DataTables/datatables.min.js'%}"></script>
{% include 'partials/admin/scripts-Datatables.html' %}

<!- para las alertas ->
    <script src="{% static 'Toastr/js/toastr.min.js' %}"></script>
    <script src="{% static 'Toastr/CSSs/toastr.min.css' %}"></script>
    {% if messages %}
    
    {% for message in messages %}
    <script>
    // Mapear tags de Django a métodos de toastr
    let messageType = '{{ message.tags }}';
    let toastrMethod;
    
    switch(messageType) {
        case 'error':
            toastrMethod = 'error';
            break;
        case 'warning':
            toastrMethod = 'warning';
            break;
        case 'success':
            toastrMethod = 'success';
            break;
        case 'info':
            toastrMethod = 'info';
            break;
        default:
            toastrMethod = 'info';
    }
    
    toastr[toastrMethod]('{{ message|safe }}', '', {
        closeButton: true,
        progressBar: true,
        positionClass: 'toast-top-center'
    });
    </script>
    {% endfor %}
    {% endif %}

    <!-- JavaScript del Loader -->
    <script>
        // Variables de control
        let isLoaded = false;
        let loadingProgress = 0;
        let loadingInterval;
        let minLoadTime = 1500; // Mínimo 1.5 segundos
        let maxLoadTime = 3000; // Máximo 3 segundos
        let startTime = Date.now();

        // Función para ocultar el loader
        function hideLoader() {
            if (isLoaded) return; // Evitar múltiples ejecuciones

            console.log('Ocultando loader...');
            isLoaded = true;

            const loader = document.getElementById('loader');
            const content = document.getElementById('content');

            if (loadingInterval) {
                clearInterval(loadingInterval);
            }

            // Completar progreso si no está al 100%
            document.getElementById('progressFill').style.width = '100%';

            // Ocultar loader con transición
            loader.classList.add('hidden');

            // Mostrar contenido después de la transición
            setTimeout(() => {
                loader.style.display = 'none';
                content.style.display = 'block';

                // Activar animación de entrada
                setTimeout(() => {
                    content.classList.add('show');
                }, 50);
            }, 500);
        }

        // Función para simular progreso de carga
        function simulateProgress() {
            const progressFill = document.getElementById('progressFill');

            loadingInterval = setInterval(() => {
                loadingProgress += Math.random() * 12 + 3;

                if (loadingProgress >= 100) {
                    loadingProgress = 100;
                    clearInterval(loadingInterval);

                    // Verificar tiempo mínimo transcurrido
                    const elapsedTime = Date.now() - startTime;
                    const remainingTime = Math.max(0, minLoadTime - elapsedTime);

                    setTimeout(hideLoader, remainingTime);
                }

                progressFill.style.width = loadingProgress + '%';
            }, 150);
        }

        // Manejo del logo
        function setupLogo() {
            const logoImg = document.getElementById('logoImg');
            const logoText = document.getElementById('logoText');

            logoImg.onerror = function () {
                console.log('Error cargando logo av1.png, mostrando fallback');
                logoImg.style.display = 'none';
                logoText.style.display = 'block';
                logoText.textContent = 'AV';
            };

            logoImg.onload = function () {
                console.log('Logo av1.png cargado correctamente');
            };

            // Si la imagen ya está en cache, onload podría no dispararse
            if (logoImg.complete) {
                logoImg.onload();
            }
        }

        // Evento DOMContentLoaded
        document.addEventListener('DOMContentLoaded', function () {
            console.log('DOM cargado, iniciando loader...');
            setupLogo();
            simulateProgress();
        });

        // Evento window.load
        window.addEventListener('load', function () {
            console.log('Todos los recursos cargados');

            // Verificar tiempo mínimo
            const elapsedTime = Date.now() - startTime;
            if (elapsedTime < minLoadTime) {
                setTimeout(hideLoader, minLoadTime - elapsedTime);
            } else {
                hideLoader();
            }
        });

        // Timeout de seguridad
        setTimeout(() => {
            if (!isLoaded) {
                console.log('Tiempo máximo alcanzado, forzando carga...');
                hideLoader();
            }
        }, maxLoadTime);
    </script>